<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard2.css') }}">
</head>
<body>
  <div id="toastContainer">
      <div id="toast" class="toast"></div>
  </div>

  <div class="container">
    <div id="loading-overlay"> ⏳ Processing, please wait...</div>
    
    <aside class="sidebar" id="sidebar">
      <div class="logo" title="Admin Dashboard">AdminPanel</div>
      <nav>
        <ul>
          <li>
            <a href="#" class="active"   data-tab="config" title="config">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
              </svg>

              <span>Config</span>
            </a>
          </li>
          <li>
            <a href="#"  data-tab="addEmployee"  title="addEmployee">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Đầu người -->
                <circle cx="12" cy="7" r="4"></circle>
                <!-- Vai và thân người -->
                <path d="M5.5 21a6.5 6.5 0 0 1 13 0"></path>
                <!-- Dấu cộng "thêm" nằm bên phải -->
                <line x1="19" y1="8" x2="19" y2="14"></line>
                <line x1="16" y1="11" x2="22" y2="11"></line>
              </svg>

              <span>Add Employee</span>
            </a>
          </li>
          <li>
            <a href="#"  data-tab="exportTimekeeping" title="exportTimekeeping">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Vòng tròn đồng hồ -->
                <circle cx="12" cy="12" r="10"></circle>
                <!-- Kim giờ -->
                <line x1="12" y1="12" x2="12" y2="7"></line>
                <!-- Kim phút -->
                <line x1="12" y1="12" x2="16" y2="12"></line>
              </svg>

              <span>Timekeeping</span>
            </a>
          </li>
          <li>
            <a href="#" data-tab="deletePerson" title="deletePerson">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <!-- Đầu người -->
                <circle cx="12" cy="8" r="4"></circle>
                <!-- Vai và thân người -->
                <path d="M5 20c0-3 4-5 7-5s7 2 7 5"></path>
                <!-- Dấu X xóa người nằm bên phải đầu -->
                <line x1="18" y1="5" x2="22" y2="9"></line>
                <line x1="22" y1="5" x2="18" y2="9"></line>
              </svg>

              <span>Delete Employee</span>
            </a>
          </li>

          <li>
            <a href="#" data-tab="deleteBucket" title="deleteBucket">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="9" x2="15" y2="15"></line>
                <line x1="15" y1="9" x2="9" y2="15"></line>
              </svg>
              <span>Delete Bucket</span>
            </a>
          </li>

          <li>
            <a href="#" data-tab="openCameraTab" title="Open Camera">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="7" width="18" height="13" rx="2"/>
                <circle cx="12" cy="13" r="4"/>
                <path d="M5 7V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2"/>
              </svg>
              <span>Open Camera</span>
            </a>
          </li>

        </ul>
      </nav>
    </aside>
    <div class="content">
      <header class="topbar">
        <button class="toggle-btn" id="sidebarToggle" aria-label="Toggle Sidebar">&#9776;</button>
        <!-- Decorative icon instead of search/decor bar -->
        <div style="display: flex; align-items: center; justify-content: center;">
          <img src="{{ url_for('static', filename='assets/title_gif.gif') }}" alt="Decorative wave" style="max-height: 40px; border-radius: 8px; box-shadow: 0 2px 12px rgba(24,90,157,0.10);">
          <img src="{{ url_for('static', filename='assets/title_gif.gif') }}" alt="Decorative wave" style="max-height: 40px; border-radius: 8px; box-shadow: 0 2px 12px rgba(24,90,157,0.10); margin-left: 8px;">
          <img src="{{ url_for('static', filename='assets/title_gif.gif') }}" alt="Decorative wave" style="max-height: 40px; border-radius: 8px; box-shadow: 0 2px 12px rgba(24,90,157,0.10); margin-left: 8px;">
          <img src="{{ url_for('static', filename='assets/title_gif.gif') }}" alt="Decorative wave" style="max-height: 40px; border-radius: 8px; box-shadow: 0 2px 12px rgba(24,90,157,0.10); margin-left: 8px;">
          <img src="{{ url_for('static', filename='assets/title_gif.gif') }}" alt="Decorative wave" style="max-height: 40px; border-radius: 8px; box-shadow: 0 2px 12px rgba(24,90,157,0.10); margin-left: 8px;">
          <img src="{{ url_for('static', filename='assets/title_gif.gif') }}" alt="Decorative wave" style="max-height: 40px; border-radius: 8px; box-shadow: 0 2px 12px rgba(24,90,157,0.10); margin-left: 8px;">
        </div>
        <div class="actions">
          <button id="notificationBtn" aria-label="Notifications" title="Notifications" style="position: relative;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
              <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="badge" id="notificationBadge">0</span>
          </button>

          <!-- Dropdown notifications -->
          <div id="notificationDropdown" class="notification-dropdown hidden">
            <ul id="notificationList">
            </ul>
          </div>

          <button id="companyInfoBtn" aria-label="Company Info" title="Company Info">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
              <circle cx="12" cy="7" r="4"></circle>
              <path d="M5.5 21a8.38 8.38 0 0 1 13 0"></path>
            </svg>
          </button>
          <span id="employeeCountInfo" class="employee-count-info"></span>
          <div class="profile" tabindex="0" aria-label="User Profile">
            {% if logo_url %}
              <img src="{{ logo_url }}" alt="Company Logo" />
            {% else %}
              <img src="https://i.pravatar.cc/36" alt="User Avatar" />
            {% endif %}
            <span>{{ bucket_name }}</span>
          </div>
        </div>
      </header>
      <main class="dashboard">
        <section id="config" class="tab-content active">
              <h2>⚙️ Configuration</h2>
              <div class="config-container">
                  <!-- infer_video -->
                  <div class="config-box">
                      <h3>Infer_video</h3>
                      <div class="setting">
                          <label for="min_face_area">Min_face_area:</label>
                          <input type="range" id="min_face_area" min="0.01" max="1" step="0.01" 
                                  value="{{ config['infer_video']['min_face_area'] }}" 
                                  oninput="updateValue('min_face_area_val', this.value)">
                          <span id="min_face_area_val">{{ config['infer_video']['min_face_area'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="bbox_threshold">Bbox_threshold:</label>
                          <input type="range" id="bbox_threshold" min="0.1" max="1" step="0.01" 
                                  value="{{ config['infer_video']['bbox_threshold'] }}" 
                                  oninput="updateValue('bbox_threshold_val', this.value)">
                          <span id="bbox_threshold_val">{{ config['infer_video']['bbox_threshold'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="required_images">Required_images:</label>
                          <input type="range" id="required_images" min="1" max="50" step="1" 
                                  value="{{ config['infer_video']['required_images'] }}" 
                                  oninput="updateValue('required_images_val', this.value)">
                          <span id="required_images_val">{{ config['infer_video']['required_images'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="validation_threshold">Validation_threshold:</label>
                          <input type="range" id="validation_threshold" min="0.1" max="1" step="0.01" 
                                  value="{{ config['infer_video']['validation_threshold'] }}" 
                                  oninput="updateValue('validation_threshold_val', this.value)">
                          <span id="validation_threshold_val">{{ config['infer_video']['validation_threshold'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="is_anti_spoof">Is_anti_spoof:</label>
                          <label class="switch">
                              <input type="checkbox" id="is_anti_spoof" {% if config['infer_video']['is_anti_spoof'] %}checked{% endif %}>
                              <span class="slider round"></span>
                          </label>
                      </div>
                      <div class="setting">
                          <label for="anti_spoof_threshold">Anti_spoof_threshold:</label>
                          <input type="range" id="anti_spoof_threshold" min="0.1" max="1" step="0.01" 
                                  value="{{ config['infer_video']['anti_spoof_threshold'] }}" 
                                  oninput="updateValue('anti_spoof_threshold_val', this.value)">
                          <span id="anti_spoof_threshold_val">{{ config['infer_video']['anti_spoof_threshold'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="qscore_threshold">Quality_score_threshold:</label>
                          <input type="range" id="qscore_threshold" min="0.1" max="1" step="0.01" 
                                  value="{{ config['infer_video']['qscore_threshold'] }}" 
                                  oninput="updateValue('qscore_threshold_val', this.value)">
                          <span id="qscore_threshold_val">{{ config['infer_video']['qscore_threshold'] }}</span>
                      </div>
                  </div>
                  
                  <!-- identity_person -->
                  <div class="config-box">
                      <h3>Identity_person</h3>
                      <div class="setting">
                          <label for="l2_threshold">L2_threshold:</label>
                          <input type="range" id="l2_threshold" min="0" max="50" step="0.1" 
                                  value="{{ config['identity_person']['l2_threshold'] }}" 
                                  oninput="updateValue('l2_threshold_val', this.value)">
                          <span id="l2_threshold_val">{{ config['identity_person']['l2_threshold'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="cosine_threshold">Cosine_threshold:</label>
                          <input type="range" id="cosine_threshold" min="0" max="1" step="0.01" 
                                  value="{{ config['identity_person']['cosine_threshold'] }}" 
                                  oninput="updateValue('cosine_threshold_val', this.value)">
                          <span id="cosine_threshold_val">{{ config['identity_person']['cosine_threshold'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="qscore_collect_threshold">Qscore_collect_threshold:</label>
                          <input type="range" id="qscore_collect_threshold" min="0" max="1" step="0.01" 
                                  value="{{ config['identity_person']['qscore_collect_threshold'] }}" 
                                  oninput="updateValue('qscore_collect_threshold_val', this.value)">
                          <span id="qscore_collect_threshold_val">{{ config['identity_person']['qscore_collect_threshold'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="image_per_class">Image_per_class:</label>
                          <input type="range" id="image_per_class" min="1" max="10" step="1" 
                                  value="{{ config['identity_person']['image_per_class'] }}" 
                                  oninput="updateValue('image_per_class_val', this.value)">
                          <span id="image_per_class_val">{{ config['identity_person']['image_per_class'] }}</span>
                      </div>
                      <div class="setting">
                          <label for="identity_distance_mode">Distance_mode:</label>
                          <select id="identity_distance_mode" onchange="updateValue('identity_distance_mode_val', this.value)">
                              <option value="cosine" {% if config['identity_person']['distance_mode'] == 'cosine' %}selected{% endif %}>cosine</option>
                              <option value="euclidean" {% if config['identity_person']['distance_mode'] == 'euclidean' %}selected{% endif %}>euclidean</option>
                          </select>
                          <span id="identity_distance_mode_val">{{ config['identity_person']['distance_mode'] }}</span>
                      </div>
                  </div>
              </div>
      
              <button onclick="saveConfig()">Save Configuration</button>
        </section>


        <section id="addEmployee" class="tab-content">
          <h2>ADD EMPLOYEE</h2>
          <form id="employeeForm" method="POST" enctype="multipart/form-data">
            <div class="setting">
              <label for="name">Name:</label>
              <input type="text" id="name" name="name" required placeholder="Enter employee name">
            </div>
        
            <div class="setting">
              <label for="age">Age:</label>
              <input type="number" id="age" name="age" required placeholder="Enter employee age">
            </div>
        
            <div class="setting">
              <label for="gender">Gender:</label>
              <select id="gender" name="gender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
        
            <div class="setting">
              <label for="salary">Salary:</label>
              <input type="number" id="salary" name="salary" value="0" required placeholder="Enter salary">
            </div>
        
            <div class="setting">
              <label for="email">Email:</label>
              <input type="email" id="email" name="email" placeholder="Enter email (optional)">
            </div>
        
            <div class="setting">
              <label for="year">Experience Year:</label>
              <input type="number" id="year" name="year" value="1" required placeholder="Enter years of experience">
            </div>
        
            
            <div class="setting buttons" >
                <button type="button" id="open-upload-btn">Upload </button>
                <button type="button" id="open-modal-btn">Camera</button>
            </div>

            <!-- Hidden file input & hidden captured image input -->
            <input type="file" id="upload-photo-hidden" accept="image/*" multiple style="display: none;">
            <input type="hidden" id="photo-input" name="photo">
            
            <button type="submit">Add Employee</button>
          </form>

          <!-- Modal Camera -->
          <div id="camera-modal" class="modal">
            <div class="modal-content">
              <button class="close-btn" id="close-modal">&times;</button>
              <h3>Take Employee Photo</h3>
              <div class="camera-container">
                <video id="video" autoplay playsinline></video>
                <svg class="progress-svg" viewBox="0 0 300 400">
                  <ellipse class="ellipse-path" cx="150" cy="200" rx="140" ry="190"/>
                  <ellipse class="progress-fill" cx="150" cy="200" rx="140" ry="190"/>
                </svg>
                <div class="progress-text">0/{{ config['identity_person']['image_per_class'] }}</div>
              </div>
              <!-- <button id="capture">Capture Photo</button> -->
            </div>
          </div>


          <div id="upload-modal" class="modal">
            <div class="modal-content">
              <button class="close-btn" id="close-upload-modal">&times;</button>
              <h3>Select Photos from Your Computer</h3>
              <input type="file" id="upload-photo-real" accept="image/*" multiple>
              <p style="margin-top: 1rem;">You can select multiple photos.</p>
            </div>
          </div>


        </section>


        <section id="exportTimekeeping" class="tab-content">
            <h2>Export Timekeeping Data</h2>
            
            <label for="exportDate">📅 Select date:</label>
            <input type="date" id="exportDate" name="exportDate" required />

            
            <div class="button-group">
              <button id="toggleDetailBtn" onclick="toggleTimekeeping()">View Details</button>
              <button id="downloadBtn" onclick="downloadExcel()">Export to Excel</button>
            </div>
            
            <div id="tableContainer"></div>
        </section>

        <div id="overlay" class="overlay"></div>

        <section id='deletePerson' class="tab-content">
          <div  id='deletePersonContainer'>
              <h2>🗑️ Delete Employee</h2>
              <p>Select an employee to delete:</p>
              
              <select id="personListSelect">
                <!-- Các item sẽ được thêm vào ở đây thông qua JS -->
              </select>
              <button onclick="deleteEmployee()">Delete Employee</button>
            
          </div>
           
        
        </section>


        <section id="deleteBucket" class="tab-content">
          <div class="delete-bucket-center">
            <h2>🗑️ Delete Bucket</h2>
            <button id="showConfirmDeleteBtn">Delete Bucket</button>

            <!-- Popup xác nhận xóa bucket -->
            <div id="deleteBucketModal" class="modal" style="display:none;">
              <div class="modal-content">
                <span class="close" id="closeDeleteBucketModal">&times;</span>
                <h3>Confirm Delete Bucket</h3>
                <p>Type the bucket name to confirm:</p>
                <input type="text" id="confirmBucketName" placeholder="Enter bucket name to confirm" />
                <button id="deleteBucketBtn">Confirm Delete</button>
              </div>
            </div>
          </div>
        </section>
        
        <section id="openCameraTab" class="tab-content">
          <div class="open-camera-center">
            <h2>🎥 Open Camera</h2>
            <button class="open-camera-btn" onclick="window.location.href='/'">Open Camera</button>
          </div>
        </section>

      </main>
    </div>
  </div>

  <script>
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebarToggle');
    const navLinks = document.querySelectorAll('.sidebar nav a');
    const tabContents = document.querySelectorAll('.tab-content');

    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
    });

    navLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const tab = link.getAttribute('data-tab');

        navLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');

        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === tab) content.classList.add('active');
        });
      });
    });

    function updateValue(id, value) {
      document.getElementById(id).innerText = value;
    }

  </script>
  <script>
    const image_per_class = {{config['identity_person']['image_per_class'] }};
    const qscore_collect_threshold = {{ config['identity_person']['qscore_collect_threshold'] }};
  </script>

  <script src="{{ url_for('static', filename='js/dashboard2.js') }}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  
</body>

</html>


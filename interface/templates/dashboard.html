<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üéõÔ∏è Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

</head>

<body>
    <div class="dashboard-container">
        <!-- Fixed left sidebar -->
        <div class="sidebar">
            <h2>üìã Admin</h2>
            <p style="color: #ccc; font-size: 14px;">ü™£ Bucket: <strong>{{ bucket_name }}</strong></p>
            <ul>
                <li><button onclick="showTab('config')">Config</button></li>
                <li><button onclick="showTab('addEmployee')">Add Employee</button></li>
                <li><button onclick="showTab('createEmbedding')">Create Embedding</button></li>
                <li><button onclick="showTab('exportTimekeeping')">Export Timekeeping</button></li>
            </ul>
            <a href="/">
                <button>üé• Open camera</button>
            </a>
        </div>

        <!-- Main content, scrollable -->
        <div class="main-content">
            <div id="config" class="tab-content">
                <h2>üé• Configuration</h2>
        
                <div class="config-container">
                    <!-- infer_video -->
                    <div class="config-box">
                        <h3>infer_video</h3>
                        <div class="setting">
                            <label for="min_face_area">min_face_area:</label>
                            <input type="range" id="min_face_area" min="0.01" max="1" step="0.01" 
                                   value="{{ config['infer_video']['min_face_area'] }}" 
                                   oninput="updateValue('min_face_area_val', this.value)">
                            <span id="min_face_area_val">{{ config['infer_video']['min_face_area'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="bbox_threshold">bbox_threshold:</label>
                            <input type="range" id="bbox_threshold" min="0.1" max="1" step="0.01" 
                                   value="{{ config['infer_video']['bbox_threshold'] }}" 
                                   oninput="updateValue('bbox_threshold_val', this.value)">
                            <span id="bbox_threshold_val">{{ config['infer_video']['bbox_threshold'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="required_images">required_images:</label>
                            <input type="range" id="required_images" min="1" max="50" step="1" 
                                   value="{{ config['infer_video']['required_images'] }}" 
                                   oninput="updateValue('required_images_val', this.value)">
                            <span id="required_images_val">{{ config['infer_video']['required_images'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="validation_threshold">validation_threshold:</label>
                            <input type="range" id="validation_threshold" min="0.1" max="1" step="0.01" 
                                   value="{{ config['infer_video']['validation_threshold'] }}" 
                                   oninput="updateValue('validation_threshold_val', this.value)">
                            <span id="validation_threshold_val">{{ config['infer_video']['validation_threshold'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="is_anti_spoof">is_anti_spoof:</label>
                            <label class="switch">
                                <input type="checkbox" id="is_anti_spoof" {% if config['infer_video']['is_anti_spoof'] %}checked{% endif %}>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting">
                            <label for="distance_mode">distance_mode:</label>
                            <select id="distance_mode" onchange="updateValue('distance_mode_val', this.value)">
                                <option value="cosine" {% if config['infer_video']['distance_mode'] == 'cosine' %}selected{% endif %}>cosine</option>
                                <option value="euclidean" {% if config['infer_video']['distance_mode'] == 'euclidean' %}selected{% endif %}>euclidean</option>
                            </select>
                            <span id="distance_mode_val">{{ config['infer_video']['distance_mode'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="anti_spoof_threshold">anti_spoof_threshold:</label>
                            <input type="range" id="anti_spoof_threshold" min="0.1" max="1" step="0.01" 
                                   value="{{ config['infer_video']['anti_spoof_threshold'] }}" 
                                   oninput="updateValue('anti_spoof_threshold_val', this.value)">
                            <span id="anti_spoof_threshold_val">{{ config['infer_video']['anti_spoof_threshold'] }}</span>
                        </div>
                    </div>
        
                    <!-- identity_person -->
                    <div class="config-box">
                        <h3>identity_person</h3>
                        <div class="setting">
                            <label for="l2_threshold">l2_threshold:</label>
                            <input type="range" id="l2_threshold" min="0" max="50" step="0.1" 
                                   value="{{ config['identity_person']['l2_threshold'] }}" 
                                   oninput="updateValue('l2_threshold_val', this.value)">
                            <span id="l2_threshold_val">{{ config['identity_person']['l2_threshold'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="cosine_threshold">cosine_threshold:</label>
                            <input type="range" id="cosine_threshold" min="0" max="1" step="0.01" 
                                   value="{{ config['identity_person']['cosine_threshold'] }}" 
                                   oninput="updateValue('cosine_threshold_val', this.value)">
                            <span id="cosine_threshold_val">{{ config['identity_person']['cosine_threshold'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="identity_distance_mode">distance_mode:</label>
                            <select id="identity_distance_mode" onchange="updateValue('identity_distance_mode_val', this.value)">
                                <option value="cosine" {% if config['identity_person']['distance_mode'] == 'cosine' %}selected{% endif %}>cosine</option>
                                <option value="euclidean" {% if config['identity_person']['distance_mode'] == 'euclidean' %}selected{% endif %}>euclidean</option>
                            </select>
                            <span id="identity_distance_mode_val">{{ config['identity_person']['distance_mode'] }}</span>
                        </div>
                    </div>
        
                    <!-- collect_data -->
                    <div class="config-box">
                        <h3>collect_data</h3>
                        <div class="setting">
                            <label for="collect_min_face_area">min_face_area:</label>
                            <input type="range" id="collect_min_face_area" min="0.01" max="100000" step="1" 
                                   value="{{ config['collect_data']['min_face_area'] }}" 
                                   oninput="updateValue('collect_min_face_area_val', this.value)">
                            <span id="collect_min_face_area_val">{{ config['collect_data']['min_face_area'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="collect_bbox_threshold">bbox_threshold:</label>
                            <input type="range" id="collect_bbox_threshold" min="0.1" max="1" step="0.01" 
                                   value="{{ config['collect_data']['bbox_threshold'] }}" 
                                   oninput="updateValue('collect_bbox_threshold_val', this.value)">
                            <span id="collect_bbox_threshold_val">{{ config['collect_data']['bbox_threshold'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="collect_required_images">required_images:</label>
                            <input type="range" id="collect_required_images" min="1" max="50" step="1" 
                                   value="{{ config['collect_data']['required_images'] }}" 
                                   oninput="updateValue('collect_required_images_val', this.value)">
                            <span id="collect_required_images_val">{{ config['collect_data']['required_images'] }}</span>
                        </div>
                        <div class="setting">
                            <label for="collect_is_anti_spoof">is_anti_spoof:</label>
                            <label class="switch">
                                <input type="checkbox" id="collect_is_anti_spoof" {% if config['collect_data']['is_anti_spoof'] %}checked{% endif %}>
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting">
                            <label for="collect_anti_spoof_threshold">anti_spoof_threshold:</label>
                            <input type="range" id="collect_anti_spoof_threshold" min="0.1" max="1" step="0.01" 
                                   value="{{ config['collect_data']['anti_spoof_threshold'] }}" 
                                   oninput="updateValue('collect_anti_spoof_threshold_val', this.value)">
                            <span id="collect_anti_spoof_threshold_val">{{ config['collect_data']['anti_spoof_threshold'] }}</span>
                        </div>
                    </div>
                </div>
        
                <button onclick="saveConfig()">üíæ Save Configuration</button>
            </div>

            <!-- add employees -->
            <div id="addEmployee" class="tab-content">
                <h2>üÜïüßë‚Äçüíº Add Employee</h2>
                <form id="employeeForm" method="POST" enctype="multipart/form-data">
                  <div class="setting">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required placeholder="Enter employee name">
                  </div>
                  <div class="setting">
                    <label for="age">Age:</label>
                    <input type="number" id="age" name="age" required placeholder="Enter employee age">
                  </div>
                  <div class="setting">
                    <label for="gender">Gender:</label>
                    <select id="gender" name="gender">
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div class="setting">
                    <label for="salary">Salary:</label>
                    <input type="number" id="salary" name="salary" value="0" required placeholder="Enter salary">
                  </div>
                  <div class="setting">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" placeholder="Enter email (optional)">
                  </div>
                  <div class="setting">
                    <label for="year">Experience Year:</label>
                    <input type="number" id="year" name="year" value="1" required placeholder="Enter years of experience">
                  </div>
                  
                  <input type="hidden" id="photo-input" name="photo">
                  
                  <!-- Button to open camera modal -->
                  <div class="setting">
                    <button type="button" id="open-modal-btn">Open Camera</button>
                  </div>
                  
                  <button type="submit">Add Employee</button>
                </form>

                <div id="toast" class="toast">Photo has been taken!</div>
            
                <!-- Camera modal overlay -->
                <div id="camera-modal" class="modal">
                    <div class="modal-content">
                        <button class="close-btn" id="close-modal">&times;</button>
                        <h3>Take Employee Photo</h3>
                        <video id="video" autoplay playsinline></video>
                        <button id="capture">Capture Photo</button>
                    </div>
                </div>
            </div>
              
        
            <div id="createEmbedding" class="tab-content">
                <h2>üß† Create Embedding</h2>
                <p>The embedding creation process begins by gathering data from the Firebase Realtime Database, which stores employee information and their images. These images are then processed using face detection models (such as MTCNN or YOLO) to ensure only valid face images are used.</p>
                <p>The aligned images are passed through a face recognition model (e.g., cosface) to generate embeddings for each face. Once the process is complete, the embeddings are stored locally and uploaded to Cloudinary for easy access and future use.</p>
                <p>Steps involved:</p>
                <ul>
                    <li>Collect and process face images from employee data</li>
                    <li>Apply face detection models (MTCNN or YOLO) for alignment</li>
                    <li>Pass aligned images through a face recognition model to generate embeddings</li>
                    <li>Store embeddings and metadata both locally and on Cloudinary</li>
                </ul>
                <button onclick="createEmbedding()">Create Embedding</button>
                <p id="embeddingStatus"></p>
            </div>
            
            
            <div id="exportTimekeeping" class="tab-content">
                <h2>üìä Export timekeeping data</h2>
            
                <!-- Khung ch·ªçn ng√†y -->
                <label for="exportDate">üìÖ Select date:</label>
                <input type="date" id="exportDate" name="exportDate" required />
            
                <!-- Animation Loading Hidden Initially -->
                <div id="exportAnimation" class="export-animation hidden">
                    <img src="https://i.gifer.com/VAyR.gif" alt="Loading..." />
                </div>
            
                <button onclick="exportTimekeeping()">üöÄ B·∫Øt ƒë·∫ßu xu·∫•t d·ªØ li·ªáu</button>
            
                <p id="exportStatus"></p>
            </div>
            
            
        </div>
    </div>

    <script>
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.style.display = 'none');
            document.getElementById(tabId).style.display = 'block';
        }

        function updateValue(id, value) {
            document.getElementById(id).innerText = value;
        }
        
        // Default show config tab
        showTab('config');

    </script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
